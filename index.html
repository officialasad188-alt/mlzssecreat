<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aryanta AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #131314; --primary-text-color: #e3e3e3; --secondary-text-color: #8e9092;
            --container-bg-color: rgba(30, 31, 32, 0.85); --sidebar-bg-color: rgba(20, 21, 22, 0.85);
            --accent-color: #8ab4f8; --user-message-bg: #2a2b2c;
            --ai-message-bg: #343541; --ai-accent-color: #9B72CB;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow: hidden; }
        body {
            font-family: 'Poppins', sans-serif; color: var(--primary-text-color); display: flex;
            justify-content: center; align-items: center;
            background: linear-gradient(135deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff);
            background-size: 1000% 1000%; animation: gradient-animation 25s ease infinite;
        }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        #start-screen {
            display: flex; flex-direction: column; align-items: center; text-align: center; 
            animation: fadeInUp 0.8s ease-out; transition: opacity 0.5s ease-out, transform 0.5s ease-out;
            background: var(--container-bg-color); padding: 40px; border-radius: 12px; backdrop-filter: blur(10px);
        }
        #logo { width: 120px; margin-bottom: 20px; animation: fadeInUp 0.8s ease-out 0.2s; animation-fill-mode: backwards; }
        #start-screen h1 {
            font-size: 5rem; font-weight: 600; background: linear-gradient(90deg, #4285F4, #9B72CB, #D96570, #F2A60C);
            background-size: 300% 100%; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; animation: gradient-animation 10s ease infinite; margin-bottom: 20px;
        }
        #startButton {
            background-color: var(--accent-color); color: var(--bg-color); border: none; border-radius: 8px;
            padding: 12px 30px; font-size: 18px; font-weight: 500; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        #startButton:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(138, 180, 248, 0.4); }
        #app-container {
            width: 100vw; height: 100vh; display: none; flex-direction: row;
            background-color: var(--container-bg-color); backdrop-filter: blur(10px);
            opacity: 0; transform: scale(0.95); transition: opacity 0.5s ease-in, transform 0.5s ease-in;
        }
        .visible { display: flex !important; } .active { opacity: 1 !important; transform: scale(1) !important; }
        #sidebar {
            width: 260px; background-color: var(--sidebar-bg-color); padding: 15px;
            border-right: 1px solid rgba(255, 255, 255, 0.1); display: flex; flex-direction: column; gap: 10px;
        }
        #newChatButton {
            width: 100%; background-color: transparent; border: 1px solid var(--secondary-text-color);
            color: var(--primary-text-color); padding: 10px; border-radius: 8px; cursor: pointer; font-size: 16px;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        #newChatButton:hover { background-color: rgba(255, 255, 255, 0.1); border-color: var(--accent-color); }
        #chatHistory { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; }
        .history-item-container { display: flex; align-items: center; position: relative; }
        .history-item {
            flex-grow: 1; background: none; border: none; color: var(--secondary-text-color);
            padding: 10px; border-radius: 6px; text-align: left; cursor: pointer;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: all 0.2s ease;
        }
        .history-item:hover { background-color: var(--user-message-bg); color: var(--primary-text-color); }
        .history-menu-btn {
            background: none; border: none; color: var(--secondary-text-color); cursor: pointer; padding: 5px;
            border-radius: 50%; line-height: 1; margin-left: 5px;
        }
        .history-menu-btn:hover { background-color: var(--user-message-bg); color: var(--primary-text-color); }
        .history-dropdown {
            display: none; position: absolute; right: 0; top: 35px; background-color: #343541;
            border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 10; width: 120px;
        }
        .history-dropdown.show { display: block; }
        .dropdown-item {
            background: none; border: none; color: var(--primary-text-color); width: 100%;
            padding: 10px; text-align: left; cursor: pointer;
        }
        .dropdown-item:hover { background-color: var(--accent-color); color: var(--bg-color); }

        #chat-interface { flex-grow: 1; display: flex; flex-direction: column; position: relative; }
        #chat-logo-watermark {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 250px; opacity: 0.05; pointer-events: none; transition: opacity 0.5s ease;
        }
        .chat-window { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .message-pair { display: flex; flex-direction: column; gap: 10px; }
        .user-message, .ai-message {
            display: flex; align-items: center; /* Aligns text and button */
            padding: 12px 18px; border-radius: 18px; max-width: 85%;
            word-wrap: break-word; animation: fadeInUp 0.4s ease-out; white-space: pre-wrap;
        }
        .user-message { background-color: var(--user-message-bg); border-bottom-right-radius: 4px; align-self: flex-end; }
        .ai-message { background-color: var(--ai-message-bg); border-bottom-left-radius: 4px; align-self: flex-start; }
        .message-content { flex-grow: 1; } /* Allows text to take up available space */
        .ai-message pre {
            font-family: monospace; font-size: 1.1em; padding: 10px; margin-top: 8px;
            background-color: rgba(0,0,0,0.2); border-radius: 6px; white-space: pre-wrap; line-height: 1.5;
        }
        .user-message b { color: var(--accent-color); }
        .ai-message b { color: var(--ai-accent-color); }
        /* NEW: Individual, small speaker button */
        .speak-btn {
            background: none; border: none; cursor: pointer; padding: 0;
            margin-left: 10px; opacity: 0.5; transition: opacity 0.2s ease;
        }
        .speak-btn:hover { opacity: 1; }
        .speak-btn svg { width: 16px; height: 16px; fill: var(--secondary-text-color); }
        
        .input-area { display: flex; align-items: center; padding: 15px 20px; border-top: 1px solid #333; }
        textarea {
            flex-grow: 1; background-color: #2a2b2c; border: none; border-radius: 8px; padding: 15px; color: var(--primary-text-color);
            font-family: 'Poppins', sans-serif; font-size: 16px; resize: none; height: 50px; transition: box-shadow 0.2s ease; outline: none;
        }
        textarea:focus { box-shadow: 0 0 0 2px var(--accent-color); }
        .input-button {
            background: none; border: none; cursor: pointer; padding: 10px; margin-left: 8px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; transition: opacity 0.2s ease;
        }
        .input-button svg { width: 24px; height: 24px; fill: var(--secondary-text-color); transition: fill 0.2s ease; }
        .input-button:hover:not(:disabled) svg { fill: var(--accent-color); }
        #predefined-questions { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; padding: 0 10px; animation: fadeInUp 0.6s ease-out 0.3s; animation-fill-mode: backwards; }
        .predefined-q { background-color: rgba(255, 255, 255, 0.05); color: var(--primary-text-color); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 8px 16px; font-size: 14px; cursor: pointer; transition: background-color 0.2s ease; }
        .predefined-q:hover { background-color: rgba(255, 255, 255, 0.1); border-color: var(--accent-color); }
        .typing-cursor::after { content: 'â–‹'; animation: blink 1s step-end infinite; color: var(--ai-accent-color); }
        @keyframes blink { from, to { opacity: 1; } 50% { opacity: 0; } }
    </style>
</head>
<body>
    <div id="start-screen">
        <img id="logo" src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/405ba96c-ee6d-452d-a99a-38ae2fd6b74b.png" alt="Aryanta AI Logo">
        <h1>aryanta AI</h1>
        <button id="startButton">Start</button>
    </div>
    <div id="app-container">
        <div id="sidebar">
            <button id="newChatButton">+ New Chat</button>
            <hr style="border-color: rgba(255,255,255,0.1); margin: 10px 0;">
            <div id="chatHistory"></div>
        </div>
        <div id="chat-interface">
            <img id="chat-logo-watermark" src="https://user-gen-media-assets.s3.amazonaws.com/gpt4o_images/405ba96c-ee6d-452d-a99a-38ae2fd6b74b.png" alt="Chat Watermark">
            <div class="chat-window" id="chatWindow"></div>
            <div class="input-area">
                <button id="attachButton" class="input-button" title="Attach File"><svg viewBox="0 0 24 24"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"></path></svg></button>
                <textarea id="userInput" placeholder="Ask aryanta AI anything..." spellcheck="true"></textarea>
                <button id="stopButton" class="input-button" title="Stop Generating" style="display: none;"><svg viewBox="0 0 24 24"><path d="M6 6h12v12H6z"></path></svg></button>
                <button id="sendButton" class="input-button" title="Send"><svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg></button>
            </div>
        </div>
    </div>

    <script>
        const ui = {
            startScreen: document.getElementById('start-screen'), appContainer: document.getElementById('app-container'),
            startButton: document.getElementById('startButton'), chatWindow: document.getElementById('chatWindow'),
            userInput: document.getElementById('userInput'), sendButton: document.getElementById('sendButton'),
            stopButton: document.getElementById('stopButton'), attachButton: document.getElementById('attachButton'),
            newChatButton: document.getElementById('newChatButton'), chatHistoryContainer: document.getElementById('chatHistory'),
            chatWatermark: document.getElementById('chat-logo-watermark')
        };
        
        let typingIntervalId = null;
        let currentChatId = null;
        let indianEnglishVoice = null;

        const localKnowledgeBase = {
            'hi': 'Hello! How can I help you today?', 'hello': 'Hi there!',
            'how are you': 'I am a computer program, but I am running perfectly! Thanks for asking.',
            'thank you': 'You\'re welcome!', 'thanks': 'No problem!', 'bye': 'Goodbye!',
            'what is your name': 'You can call me Aryanta AI.', 'who are you': 'I am Aryanta AI.',
            'who created you': 'I was built by a talented developer passionate about AI.',
            'what can you do': 'I can answer questions, solve math problems step-by-step, and chat with you.',
            'tell me a joke': 'Why did the computer go to the doctor? Because it had a virus!',
            'what is the capital of india': 'The capital of India is New Delhi.',
        };

        const solveMathWithSteps = (input) => {
            let expression = input.toLowerCase().replace(/^what is/i, '').replace(/^calculate/i, '').replace(/x/g, '*').replace(/Ã·/g, '/').replace(/[^-()\d/*+.]/g, '').trim();
            if (!/[\d.]+([*\/+\-])[\d.]+/.test(expression)) return null;
            try {
                if (!isNaN(expression)) return null;
                const originalExpression = expression.replace(/\*/g, 'x');
                const steps = []; let parts = expression.split(/([*\/+\-])/);
                [['*', '/'], ['+', '-']].forEach(opGroup => {
                    for (let i = 1; i < parts.length; i += 2) {
                        if (opGroup.includes(parts[i])) {
                            const result = new Function(`return ${parts[i-1]} ${parts[i]} ${parts[i+1]}`)();
                            parts.splice(i - 1, 3, result.toString());
                            steps.push(parts.join(' ').replace(/\*/g, 'x')); i -= 2;
                        }
                    }
                });
                if (steps.length <= 1) {
                    const simpleMatch = originalExpression.match(/^(\d+\.?\d*)\s*([+\-x])\s*(\d+\.?\d*)$/);
                    if (simpleMatch) {
                        const [, num1Str, op, num2Str] = simpleMatch;
                        const resultStr = Number(parseFloat(steps[0]).toFixed(4)).toString();
                        const maxWidth = Math.max(num1Str.length, (op + " " + num2Str).length, resultStr.length);
                        const paddedTop = num1Str.padStart(maxWidth, ' '); const paddedBottom = (op + " " + num2Str).padStart(maxWidth, ' ');
                        const line = '-'.repeat(maxWidth); const paddedResult = resultStr.padStart(maxWidth, ' ');
                        const solution = `  ${paddedTop}\n  ${paddedBottom}\n  ${line}\n  ${paddedResult}`;
                        return `Here's the solution:<br><pre>${solution}</pre>`;
                    }
                }
                let solutionHTML = `Solving: ${originalExpression}\n\n`;
                steps.forEach((step, index) => { solutionHTML += `Step ${index + 1}:  = ${step}\n`; });
                const finalResult = new Intl.NumberFormat().format(Number(parseFloat(steps[steps.length - 1]).toFixed(4)));
                solutionHTML += `\nFinal Answer: ${finalResult}`;
                return `Here's the step-by-step solution:<br><pre>${solutionHTML}</pre>`;
            } catch (error) { return null; }
        };

        const stopTyping = () => {
            if (typingIntervalId) { clearInterval(typingIntervalId); typingIntervalId = null; }
            const cursor = document.querySelector('.typing-cursor');
            if (cursor) cursor.classList.remove('typing-cursor');
            ui.stopButton.style.display = 'none'; ui.sendButton.style.display = 'flex';
            ui.sendButton.disabled = false; ui.userInput.disabled = false; ui.userInput.focus();
        };

        const typewriterEffect = (element, text) => {
            return new Promise((resolve) => {
                let i = 0; element.textContent = ""; element.classList.add('typing-cursor');
                ui.stopButton.style.display = 'flex'; ui.sendButton.style.display = 'none';
                typingIntervalId = setInterval(() => {
                    if (i < text.length) {
                        element.textContent += text.charAt(i); i++;
                        ui.chatWindow.scrollTop = ui.chatWindow.scrollHeight;
                    } else { stopTyping(); resolve(); }
                }, 30);
            });
        };

        const sendMessage = async () => {
            const messageText = ui.userInput.value.trim();
            if (messageText === '' || ui.userInput.disabled) return;
            ui.chatWatermark.style.opacity = '0';
            const pq = document.getElementById('predefined-questions');
            if (pq) pq.remove();
            ui.sendButton.disabled = true; ui.userInput.disabled = true;
            displayUserMessage(messageText);
            ui.userInput.value = ''; ui.userInput.style.height = '50px';
            let aiAnswer = null, isHTML = false;
            aiAnswer = solveMathWithSteps(messageText);
            if (aiAnswer) { isHTML = true; } 
            else { aiAnswer = localKnowledgeBase[messageText.toLowerCase().replace(/[?.,!]/g, '')]; }
            if (aiAnswer) { displayAiMessage(aiAnswer, isHTML); saveConversation(messageText, aiAnswer, isHTML); } 
            else {
                const onlineAnswer = await fetchOnlineAnswer(messageText);
                displayAiMessage(onlineAnswer, true);
                saveConversation(messageText, onlineAnswer, true);
            }
        };
        
        const displayUserMessage = (text) => {
            const pair = document.createElement('div'); pair.className = 'message-pair';
            const userMsg = document.createElement('div'); userMsg.className = 'user-message';
            const content = document.createElement('div'); content.className = 'message-content';
            content.innerHTML = `<b>You:</b> <div></div>`;
            content.querySelector('div').textContent = text;
            userMsg.appendChild(content);
            userMsg.appendChild(createSpeakButton(text));
            pair.appendChild(userMsg); ui.chatWindow.appendChild(pair);
            ui.chatWindow.scrollTop = ui.chatWindow.scrollHeight;
        };

        const displayAiMessage = async (answer, isHTML) => {
            const lastPair = ui.chatWindow.querySelector('.message-pair:last-child');
            if (!lastPair) return;
            const aiMsg = document.createElement('div'); aiMsg.className = 'ai-message';
            const content = document.createElement('div'); content.className = 'message-content';
            content.innerHTML = `<b>aryanta AI:</b> `;
            const answerContent = document.createElement('div');
            content.appendChild(answerContent);
            aiMsg.appendChild(content);
            const cleanTextForSpeech = answer.replace(/<[^>]*>?/gm, '').replace(/\s+/g, ' ');
            aiMsg.appendChild(createSpeakButton(cleanTextForSpeech));
            lastPair.appendChild(aiMsg);
            if (isHTML) { answerContent.innerHTML = answer; stopTyping(); } 
            else { await typewriterEffect(answerContent, answer); }
            ui.chatWindow.scrollTop = ui.chatWindow.scrollHeight;
        };
        
        const fetchOnlineAnswer = async (q) => {
            const loader = document.createElement('div'); loader.className = 'loading-indicator';
            loader.innerHTML = `<span></span><span></span><span></span>`;
            ui.chatWindow.appendChild(loader); ui.chatWindow.scrollTop = ui.chatWindow.scrollHeight;
            let text = "";
            try {
                const res = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(`https://api.duckduckgo.com/?q=${q}&format=json`)}`);
                if (!res.ok) throw new Error('Network error');
                const data = await res.json();
                const ddg = JSON.parse(data.contents);
                text = ddg.AbstractText || (ddg.RelatedTopics && ddg.RelatedTopics[0]?.Text) || `Sorry, I couldn't find an answer.`;
            } catch (err) {
                text = `Connection problem. Search on Google: <a href="https://www.google.com/search?q=${encodeURIComponent(q)}" target="_blank">Here</a>`;
            } finally { loader.remove(); return text; }
        };

        const getHistory = () => JSON.parse(localStorage.getItem('chatHistory') || '[]');
        const saveHistory = (h) => localStorage.setItem('chatHistory', JSON.stringify(h));
        const saveConversation = (userText, aiText, isHTML) => {
            let history = getHistory();
            if (currentChatId === null) {
                currentChatId = Date.now();
                const title = userText.substring(0, 25) + (userText.length > 25 ? '...' : '');
                history.unshift({ id: currentChatId, title: title, messages: [], isPinned: false });
            }
            const chat = history.find(c => c.id === currentChatId);
            chat.messages.push({ role: 'user', content: userText });
            chat.messages.push({ role: 'ai', content: aiText, isHTML: isHTML });
            const unpinned = history.filter(c => !c.isPinned);
            while (unpinned.length > 7) {
                const oldest = unpinned.pop();
                history = history.filter(c => c.id !== oldest.id);
            }
            saveHistory(history);
            loadConversationHistory();
        };
        const loadConversationHistory = () => {
            let history = getHistory();
            history.sort((a, b) => (b.isPinned - a.isPinned) || (b.id - a.id));
            ui.chatHistoryContainer.innerHTML = '';
            history.forEach(chat => {
                const container = document.createElement('div'); container.className = 'history-item-container';
                const item = document.createElement('button'); item.className = 'history-item';
                item.textContent = `${chat.isPinned ? 'ðŸ“Œ ' : ''}${chat.title}`;
                item.onclick = () => loadSpecificConversation(chat.id);
                const menuBtn = document.createElement('button'); menuBtn.className = 'history-menu-btn';
                menuBtn.innerHTML = '&#8942;';
                const dropdown = document.createElement('div'); dropdown.className = 'history-dropdown';
                dropdown.innerHTML = `<button class="dropdown-item" data-action="pin" data-id="${chat.id}">${chat.isPinned ? 'Unpin' : 'Pin'}</button>
                                      <button class="dropdown-item" data-action="edit" data-id="${chat.id}">Edit</button>
                                      <button class="dropdown-item" data-action="delete" data-id="${chat.id}">Delete</button>`;
                menuBtn.onclick = (e) => { e.stopPropagation(); document.querySelectorAll('.history-dropdown').forEach(d => d.classList.remove('show')); dropdown.classList.toggle('show'); };
                container.append(item, menuBtn, dropdown);
                ui.chatHistoryContainer.appendChild(container);
            });
        };
        const loadSpecificConversation = (id) => {
            const chat = getHistory().find(c => c.id === id);
            if (!chat) return;
            currentChatId = id;
            ui.chatWindow.innerHTML = ''; ui.chatWatermark.style.opacity = '0';
            chat.messages.forEach((msg, i) => {
                if (msg.role === 'user') { displayUserMessage(msg.content); } 
                else if (i > 0 && chat.messages[i - 1].role === 'user') { displayAiMessage(msg.content, msg.isHTML); }
            });
        };
        const startNewChat = () => {
            currentChatId = null; ui.chatWindow.innerHTML = ''; ui.chatWatermark.style.opacity = '0.05';
            const questions = ["Hi", "125 + 8", "Tell me a joke", "10 * 5 + 50"];
            const container = document.createElement('div'); container.id = 'predefined-questions';
            questions.forEach(q => {
                const button = document.createElement('button'); button.className = 'predefined-q';
                button.innerText = q; button.onclick = () => { ui.userInput.value = q; sendMessage(); };
                container.appendChild(button);
            });
            ui.chatWindow.prepend(container); ui.userInput.focus();
        };

        const createSpeakButton = (textToSpeak) => {
            const speakBtn = document.createElement('button');
            speakBtn.className = 'speak-btn';
            speakBtn.title = 'Read Aloud';
            speakBtn.innerHTML = `<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"></path></svg>`;
            speakBtn.onclick = () => {
                if (speechSynthesis.speaking) speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                if (indianEnglishVoice) utterance.voice = indianEnglishVoice;
                speechSynthesis.speak(utterance);
            };
            return speakBtn;
        };

        const setupIndianVoice = () => {
            const voices = speechSynthesis.getVoices();
            indianEnglishVoice = voices.find(v => v.lang === 'en-IN') || 
                                 voices.find(v => v.lang.includes('en') && v.name.includes('Google') && v.name.includes('Female')) ||
                                 voices.find(v => v.lang.includes('en') && v.name.includes('Female')) ||
                                 voices.find(v => v.lang.includes('en') && v.name.includes('Nova')) ||
                                 voices.find(v => v.lang.includes('en'));
        };

        const handleHistoryMenu = (action, id) => {
            let h = getHistory();
            const c = h.find(c => c.id === id);
            if (!c) return;
            switch(action) {
                case 'pin': c.isPinned = !c.isPinned; break;
                case 'edit': const newTitle = prompt('Enter new title:', c.title); if(newTitle) c.title = newTitle; break;
                case 'delete': if(confirm('Delete this chat?')){ h = h.filter(c => c.id !== id); if (id === currentChatId) startNewChat(); } break;
            }
            saveHistory(h);
            loadConversationHistory();
        };

        ui.startButton.addEventListener('click', () => {
            ui.startScreen.style.opacity = '0'; ui.startScreen.style.transform = 'scale(0.9)';
            setTimeout(() => {
                ui.startScreen.style.display = 'none'; ui.appContainer.classList.add('visible');
                setTimeout(() => { ui.appContainer.classList.add('active'); startNewChat(); }, 50);
            }, 500);
        });
        document.addEventListener('DOMContentLoaded', () => {
            loadConversationHistory();
            speechSynthesis.onvoiceschanged = setupIndianVoice;
            if (speechSynthesis.getVoices().length) setupIndianVoice();
        });
        ui.newChatButton.addEventListener('click', startNewChat);
        ui.userInput.addEventListener('input', () => { ui.userInput.style.height = 'auto'; ui.userInput.style.height = (ui.userInput.scrollHeight) + 'px'; });
        ui.sendButton.addEventListener('click', sendMessage);
        ui.stopButton.addEventListener('click', stopTyping);
        ui.userInput.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } });
        ui.attachButton.addEventListener('click', () => alert("Attach file is not yet implemented."));
        document.addEventListener('click', (e) => { 
            if (e.target.closest('.dropdown-item')) {
                const item = e.target.closest('.dropdown-item');
                handleHistoryMenu(item.dataset.action, parseInt(item.dataset.id));
            }
            if (!e.target.matches('.history-menu-btn')) { 
                document.querySelectorAll('.history-dropdown').forEach(d => d.classList.remove('show')); 
            }
        });
    </script>
</body>
</html>
